SecurityAlert
| where TimeGenerated > ago(14d)
| where AlertName contains "malware"
| where not (
    AlertName has "Email reported by user as malware or phish"
    or AlertName has "Winring0"
    or AlertName has "Vorus"
    or AlertName has "CustomCertEnterpriseBlock"
    or AlertName has "EICAR_Test_File"
    or AlertName has "Malware detected in outbound email"
)
| mv-expand Entity = parse_json(Entities)
| where tostring(Entity.Type) =~ "host"
| extend DeviceId = tostring(Entity.MdatpDeviceId)
| where isnotempty(DeviceId)
| project DeviceId, AlertName, Description, Entities
| summarize DAlertCount = dcount(AlertName) by DeviceId
//| where DeviceId == "ab07b4461a12ddb73653738db7bf94e6d5e4a6a0"
//| distinct AlertName
